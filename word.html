<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Three.js Movimiento Fluido + OrbitControls</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: sans-serif;
    }

    #canvas-container {
      width: 100vw;
      height: 100vh;
      position: relative;
    }

    .controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .controls button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="canvas-container"></div>
  <div class="controls">
    <button data-dir="forward">⬆️</button>
    <button data-dir="left">⬅️</button>
    <button data-dir="backward">⬇️</button>
    <button data-dir="right">➡️</button>
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();

    // Cámara
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 5, 10);

    // Renderizador
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    // Controles de órbita
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.target.set(0, 1, 0);

    // Luz tipo estudio
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));
    const keyLight = new THREE.DirectionalLight(0xffffff, 0.6);
    keyLight.position.set(5, 10, 5);
    scene.add(keyLight);
    const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
    fillLight.position.set(-5, 10, -5);
    scene.add(fillLight);

    // Suelo
    const plane = new THREE.Mesh(
      new THREE.PlaneGeometry(50, 50),
      new THREE.MeshStandardMaterial({ color: 0x000000 })
    );
    plane.rotation.x = -Math.PI / 2;
    scene.add(plane);

    // Esfera personaje
    const sphere = new THREE.Mesh(
      new THREE.SphereGeometry(1, 32, 32),
      new THREE.MeshStandardMaterial({ color: 0x00ffff })
    );
    sphere.position.y = 1;
    scene.add(sphere);

    // Movimiento fluido
    const directions = {
      forward: false,
      backward: false,
      left: false,
      right: false
    };

    // Escuchar los botones
    const buttons = document.querySelectorAll('.controls button');
    buttons.forEach(btn => {
      const dir = btn.getAttribute('data-dir');
      btn.addEventListener('mousedown', () => directions[dir] = true);
      btn.addEventListener('mouseup', () => directions[dir] = false);
      btn.addEventListener('mouseleave', () => directions[dir] = false); // por si suelta fuera
      btn.addEventListener('touchstart', e => {
        e.preventDefault();
        directions[dir] = true;
      }, { passive: false });
      btn.addEventListener('touchend', () => directions[dir] = false);
    });

    // Animación
    const speed = 0.05;

    function animate() {
      requestAnimationFrame(animate);

      if (directions.forward) sphere.position.z -= speed;
      if (directions.backward) sphere.position.z += speed;
      if (directions.left) sphere.position.x -= speed;
      if (directions.right) sphere.position.x += speed;

      controls.update();
      renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
